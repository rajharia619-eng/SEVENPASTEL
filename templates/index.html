{% extends 'layout.html' %}
{% block content %}
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
  <div>
    <h2 class="text-2xl font-bold mb-4 text-accent-blue">Upcoming Events</h2>
    <div class="p-6 bg-gray-800 rounded-lg shadow-lg mb-6 border border-gray-700">
      <h3 class="text-xl font-semibold mb-3 text-gray-200">Overview</h3>
      <p class="text-gray-300">Total Revenue: <span class="text-accent-green font-bold">{{ total_revenue|rupee }}</span></p>
      <p class="text-gray-300">Total Redeemable Issued: <span class="text-accent-blue font-bold">{{ total_redeemable|rupee }}</span></p>
      <p class="text-gray-300">Total Redeemed: <span class="text-red-400 font-bold">{{ total_redeemed|rupee }}</span></p>
      <p class="text-gray-300">Remaining Balance: <span class="text-yellow-400 font-bold">{{ remaining_balance|rupee }}</span></p>
    </div>
    <a class="inline-block px-5 py-3 bg-accent-indigo text-white rounded-lg hover:bg-indigo-700 transition duration-200 font-semibold" href="{{ url_for('create_event') }}">Create New Event</a>
    <div class="mt-6 space-y-4">
      {% for ev in events %}
        <div class="p-4 bg-gray-800 rounded-lg shadow-md border border-gray-700">
          <h3 class="font-bold text-lg text-gray-100">{{ ev.title }}</h3>
          <div class="text-sm text-gray-400">{{ ev.date }}</div>
          <div class="mt-3 flex space-x-3">
            <a class="text-accent-blue hover:underline font-medium" href="{{ url_for('event_detail', event_id=ev.id) }}">View Details</a>
            <a class="text-yellow-400 hover:underline font-medium" href="{{ url_for('edit_event', event_id=ev.id) }}">Edit</a>
            <form class="inline-block" action="{{ url_for('delete_event', event_id=ev.id) }}" method="post" onsubmit="return confirm('Are you sure you want to delete this event? This action cannot be undone.');">
              <button class="text-red-500 hover:underline font-medium">Delete</button>
            </form>
          </div>
        </div>
      {% else %}
        <div class="p-4 bg-gray-800 rounded-lg shadow-md border border-gray-700 text-gray-400">No events scheduled. Create one to get started!</div>
      {% endfor %}
    </div>
  </div>
  <div>
    <h2 class="text-2xl font-bold mb-4 text-accent-blue">Quick Actions</h2>
    <div class="p-6 bg-gray-800 rounded-lg shadow-lg border border-gray-700">
      <form action="#" method="get"
        onsubmit="
          event.preventDefault();
          const q = document.getElementById('search_box').value.toLowerCase();
          if (!q.trim()) return alert('Please enter a name or QR token to search.');
          // Try QR token first
          fetch(`/ticket/search/${q}`)
            .then(r => {
              if (r.status === 200) window.location = `/ticket/search/${q}`;
              else window.location = `/search?name=${q}`;
            });
        ">

        <label class="block text-sm font-medium mb-2 text-gray-300">Search Ticket</label>
        <input id="search_box"
               type="text"
               class="border border-gray-600 bg-gray-900 text-gray-100 p-3 w-full rounded-lg focus:ring-accent-blue focus:border-accent-blue" 
               placeholder="Enter buyer name or QR token..." />

        <button class="mt-4 px-5 py-3 bg-accent-blue text-white rounded-lg w-full hover:bg-blue-600 transition duration-200 font-semibold">
          Search Ticket
        </button>
      </form>
    </div>
  </div>
</div>
{% endblock %}
